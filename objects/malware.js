import BaseObject from "./baseObject"
import KillChainPhase from './killChainPhase'
import { MalwareLabels } from '../constants/vocabulary'

class Malware extends BaseObject {

    name = null
    description = null
    killChainPhases = []
    
    constructor(name) {
        super('malware')

        this.name = name
    }

    addKillChainPhase(phase) {
        if (!(phase instanceof KillChainPhase))
            throw Error('You cannot only add a kill chain phase of the KillChainPhase type!')
            
        this.killChainPhases.push(phase)
    }

    addLabel(label) {
        if (Object.values(MalwareLabels).indexOf(label.toLowerCase()) === -1)
            throw Error(`Invalid malware label! Must be one of the following: ${Array(Object.values(MalwareLabels)).join(', ')}`)

        this.labels.append(label.toLowerCase())
    }

    toJSON() {
        if (!this.labels)
            throw Error(`STIX 2.0 requires malware labels!`)
        if (!this.name)
            throw Error(`STIX 2.0 requires a malware name!`)

        let output = super.toJSON()
        output.name = this.name

        if (this.description)
            output.description = this.description
        if (this.labels)
            output.labels = this.labels

        let killChainPhases = []
        for (let i in this.killChainPhases)
            killChainPhases.push(i.toJSON())

        if (this.killChainPhases)
            output.kill_chain_phases = killChainPhases

        return output
    }
}

export default Malware